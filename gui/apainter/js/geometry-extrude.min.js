!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.geometryExtrude={})}(this,function(t){"use strict";var e=r,n=r;function r(t,e,n){n=n||2;var r,s,u,h,c,a,p,y=e&&e.length,g=y?e[0]*n:t.length,d=o(t,0,g,n,!0),m=[];if(!d)return m;if(y&&(d=function(t,e,n,r){var l,s,u,h,c,a=[];for(l=0,s=e.length;l<s;l++)u=e[l]*r,h=l<s-1?e[l+1]*r:t.length,(c=o(t,u,h,r,!1))===c.next&&(c.steiner=!0),a.push(v(c));for(a.sort(f),l=0;l<a.length;l++)x(a[l],n),n=i(n,n.next);return n}(t,e,d,n)),t.length>80*n){r=u=t[0],s=h=t[1];for(var b=n;b<g;b+=n)c=t[b],a=t[b+1],c<r&&(r=c),a<s&&(s=a),c>u&&(u=c),a>h&&(h=a);p=0!==(p=Math.max(u-r,h-s))?1/p:0}return l(d,m,n,r,s,p),m}function o(t,e,n,r,o){var i,l;if(o===z(t,e,n,r)>0)for(i=e;i<n;i+=r)l=w(i,t[i],t[i+1],l);else for(i=n-r;i>=e;i-=r)l=w(i,t[i],t[i+1],l);return l&&d(l,l.next)&&(S(l),l=l.next),l}function i(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!d(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(S(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function l(t,e,n,r,o,f,x){if(t){!x&&f&&function(t,e,n,r){var o=t;do{null===o.z&&(o.z=a(o.x,o.y,e,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,n,r,o,i,l,s,u,h=1;do{for(n=t,t=null,i=null,l=0;n;){for(l++,r=n,s=0,e=0;e<h&&(s++,r=r.nextZ);e++);for(u=h;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(o=n,n=n.nextZ,s--):(o=r,r=r.nextZ,u--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;n=r}i.nextZ=null,h*=2}while(l>1)}(o)}(t,r,o,f);for(var v,p,y=t;t.prev!==t.next;)if(v=t.prev,p=t.next,f?u(t,r,o,f):s(t))e.push(v.i/n),e.push(t.i/n),e.push(p.i/n),S(t),t=p.next,y=p.next;else if((t=p)===y){x?1===x?l(t=h(t,e,n),e,n,r,o,f,2):2===x&&c(t,e,n,r,o,f):l(i(t),e,n,r,o,f,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(g(e,n,r)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(p(e.x,e.y,n.x,n.y,r.x,r.y,o.x,o.y)&&g(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function u(t,e,n,r){var o=t.prev,i=t,l=t.next;if(g(o,i,l)>=0)return!1;for(var s=o.x<i.x?o.x<l.x?o.x:l.x:i.x<l.x?i.x:l.x,u=o.y<i.y?o.y<l.y?o.y:l.y:i.y<l.y?i.y:l.y,h=o.x>i.x?o.x>l.x?o.x:l.x:i.x>l.x?i.x:l.x,c=o.y>i.y?o.y>l.y?o.y:l.y:i.y>l.y?i.y:l.y,f=a(s,u,e,n,r),x=a(h,c,e,n,r),v=t.prevZ,y=t.nextZ;v&&v.z>=f&&y&&y.z<=x;){if(v!==t.prev&&v!==t.next&&p(o.x,o.y,i.x,i.y,l.x,l.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,y!==t.prev&&y!==t.next&&p(o.x,o.y,i.x,i.y,l.x,l.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;v&&v.z>=f;){if(v!==t.prev&&v!==t.next&&p(o.x,o.y,i.x,i.y,l.x,l.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;y&&y.z<=x;){if(y!==t.prev&&y!==t.next&&p(o.x,o.y,i.x,i.y,l.x,l.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function h(t,e,n){var r=t;do{var o=r.prev,i=r.next.next;!d(o,i)&&m(o,r,r.next,i)&&b(o,i)&&b(i,o)&&(e.push(o.i/n),e.push(r.i/n),e.push(i.i/n),S(r),S(r.next),r=t=i),r=r.next}while(r!==t);return r}function c(t,e,n,r,o,s){var u=t;do{for(var h=u.next.next;h!==u.prev;){if(u.i!==h.i&&y(u,h)){var c=M(u,h);return u=i(u,u.next),c=i(c,c.next),l(u,e,n,r,o,s),void l(c,e,n,r,o,s)}h=h.next}u=u.next}while(u!==t)}function f(t,e){return t.x-e.x}function x(t,e){if(e=function(t,e){var n,r=e,o=t.x,i=t.y,l=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>l){if(l=s,s===o){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(o===l)return n.prev;var u,h=n,c=n.x,f=n.y,x=1/0;r=n.next;for(;r!==h;)o>=r.x&&r.x>=c&&o!==r.x&&p(i<f?o:l,i,c,f,i<f?l:o,i,r.x,r.y)&&((u=Math.abs(i-r.y)/(o-r.x))<x||u===x&&r.x>n.x)&&b(r,t)&&(n=r,x=u),r=r.next;return n}(t,e)){var n=M(e,t);i(n,n.next)}}function a(t,e,n,r,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function v(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function p(t,e,n,r,o,i,l,s){return(o-l)*(e-s)-(t-l)*(i-s)>=0&&(t-l)*(r-s)-(n-l)*(e-s)>=0&&(n-l)*(i-s)-(o-l)*(r-s)>=0}function y(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&m(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&b(t,e)&&b(e,t)&&function(t,e){var n=t,r=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{n.y>i!=n.next.y>i&&n.next.y!==n.y&&o<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)}function g(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function d(t,e){return t.x===e.x&&t.y===e.y}function m(t,e,n,r){return!!(d(t,e)&&d(n,r)||d(t,r)&&d(n,e))||g(t,e,n)>0!=g(t,e,r)>0&&g(n,r,t)>0!=g(n,r,e)>0}function b(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function M(t,e){var n=new Z(t.i,t.x,t.y),r=new Z(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,n.next=o,o.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function w(t,e,n,r){var o=new Z(t,e,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function S(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Z(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function z(t,e,n,r){for(var o=0,i=e,l=n-r;i<n;i+=r)o+=(t[l]-t[i])*(t[i+1]+t[l+1]),l=i;return o}function R(t,e,n){var r=e[0],o=e[1],i=n[0]-r,l=n[1]-o;if(0!==i||0!==l){var s=((t[0]-r)*i+(t[1]-o)*l)/(i*i+l*l);s>1?(r=n[0],o=n[1]):s>0&&(r+=i*s,o+=l*s)}return(i=t[0]-r)*i+(l=t[1]-o)*l}function A(t,e){var n=t.length-1,r=[t[0]];return function t(e,n,r,o,i){for(var l,s=o,u=n+1;u<r;u++){var h=R(e[u],e[n],e[r]);h>s&&(l=u,s=h)}s>o&&(l-n>1&&t(e,n,l,o,i),i.push(e[l]),r-l>1&&t(e,l,r,o,i))}(t,0,n,e,r),r.push(t[n]),r}function q(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return t=A(t=n?t:function(t,e){for(var n,r,o,i,l,s=t[0],u=[s],h=1,c=t.length;h<c;h++)n=t[h],o=s,i=(r=n)[0]-o[0],l=r[1]-o[1],i*i+l*l>e&&(u.push(n),s=n);return s!==n&&u.push(n),u}(t,r),r)}function B(t,e){return t[0]*e[0]+t[1]*e[1]}function O(t,e){const n=e[0],r=e[1],o=Math.sqrt(n*n+r*r);return t[0]=n/o,t[1]=r/o,t}function P(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function j(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function F(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function k(t,e){const n=e[0],r=e[1],o=e[2],i=Math.sqrt(n*n+r*r+o*o);return t[0]=n/i,t[1]=r/i,t[2]=o/i,t}r.deviation=function(t,e,n,r){var o=e&&e.length,i=o?e[0]*n:t.length,l=Math.abs(z(t,0,i,n));if(o)for(var s=0,u=e.length;s<u;s++){var h=e[s]*n,c=s<u-1?e[s+1]*n:t.length;l-=Math.abs(z(t,h,c,n))}var f=0;for(s=0;s<r.length;s+=3){var x=r[s]*n,a=r[s+1]*n,v=r[s+2]*n;f+=Math.abs((t[x]-t[v])*(t[a+1]-t[x+1])-(t[x]-t[a])*(t[v+1]-t[x+1]))}return 0===l&&0===f?0:Math.abs((f-l)/l)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var l=0;l<e;l++)n.vertices.push(t[o][i][l]);o>0&&(r+=t[o-1].length,n.holes.push(r))}return n},e.default=n;const L=[];function U(t,e,n,r){const o=(l=n,(i=e)[0]*l[0]+i[1]*l[1]+i[2]*l[2]);var i,l;const s=Math.acos(o)*r;return P(L,n,e,-o),function(t,e){const n=e[0],r=e[1],o=e[2],i=Math.sqrt(n*n+r*r+o*o);t[0]=n/i,t[1]=r/i,t[2]=o/i}(L,L),function(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}(t,e,Math.cos(s)),P(t,t,L,Math.sin(s)),t}function V(t,e,n){if(n-e<3)return 0;let r=0;for(let o=2*(n-1),i=2*e;i<2*n;){const e=t[o],n=t[o+1],l=t[i],s=t[i+1];o=i,i+=2,r+=e*s-l*n}return r}function W(t,n,r=2){return e(t,n,r)}const E=[],I=[],_=[];function D(t,e,n,r,o,i,l,s){const u=null!=l;let h=o,c=null;u&&(c=new Uint32Array(r-n));for(let o=n;o<r;o++){const f=o===r-1?n:o+1,x=o===n?r-1:o-1,a=t[2*x],v=t[2*x+1],p=t[2*o],y=t[2*o+1],g=t[2*f],d=t[2*f+1];if(E[0]=p-a,E[1]=y-v,I[0]=g-p,I[1]=d-y,O(E,E),O(I,I),u&&(c[o]=h),s||o!==n)if(s||o!==r-1){j(_,I,E);const t=_[1];_[1]=-_[0],_[0]=t,O(_,_);const n=B(_,I),r=Math.sqrt(1-n*n),o=i*Math.min(10,1/r);if(u&&1/r>l&&i*n<0){const t=p+_[0]*i,n=y+_[1]*i,o=Math.acos(r)/2,l=Math.tan(o)*Math.abs(i);e[2*h]=t+_[1]*l,e[2*h+1]=n-_[0]*l,e[2*++h]=t-_[1]*l,e[2*h+1]=n+_[0]*l,h++}else e[2*h]=p+_[0]*o,e[2*h+1]=y+_[1]*o,h++}else _[0]=E[1],_[1]=-E[0],O(_,_),e[2*h]=p+_[0]*i,e[2*h+1]=y+_[1]*i,h++;else _[0]=I[1],_[1]=-I[0],O(_,_),e[2*h]=p+_[0]*i,e[2*h+1]=y+_[1]*i,h++}return c}function G(t,e,n,r,o){const i=null!=r?[]:new Float32Array(t.length);if(D(t,i,0,e&&e.length?e[0]:t.length/2,0,n,r,o),e)for(let l=0;l<e.length;l++){const s=e[l];D(t,i,s,e[l+1]||t.length/2,null!=r?i.length/2:s,n,r,o)}return i}function J(t,e,n,r){for(let o=0;o<Math.floor((r-n)/2);o++)for(let i=0;i<e;i++){const l=(o+n)*e+i,s=(r-o-1)*e+i,u=t[l];t[l]=t[s],t[s]=u}return t}function N(t,e){let n=t.length/2,r=0,o=e&&e.length?e[0]:n;V(t,r,o)>0&&J(t,2,r,o);for(let i=1;i<(e?e.length:0)+1;i++)V(t,r=e[i-1],o=e[i]||n)<0&&J(t,2,r,o)}function C(t){t.depth=t.depth||1,t.bevelSize=t.bevelSize||0,t.bevelSegments=null==t.bevelSegments?2:t.bevelSegments,t.smoothSide=t.smoothSide||!1,t.smoothBevel=t.smoothBevel||!1,t.simplify=t.simplify||0,"number"==typeof t.depth&&(t.bevelSize=Math.min(t.bevelSegments>0?t.bevelSize:0,t.depth/2)),t.bevelSize>0||(t.bevelSegments=0),t.bevelSegments=Math.round(t.bevelSegments);const e=t.boundingRect;if(t.translate=t.translate||[0,0],t.scale=t.scale||[1,1],t.fitRect){let n=null==t.fitRect.x?e.x||0:t.fitRect.x,r=null==t.fitRect.y?e.y||0:t.fitRect.y,o=t.fitRect.width,i=t.fitRect.height;null==o?null!=i?o=i/e.height*e.width:(o=e.width,i=e.height):null==i&&(i=o/e.width*e.height),t.scale=[o/e.width,i/e.height],t.translate=[(n-e.x)*t.scale[0],(r-e.y)*t.scale[1]]}}const H=[[0,0],[1,0],[1,1],[0,0],[1,1],[0,1]];function K(t,{vertices:e,topVertices:n,depth:r,rect:o},i,l,s,u){const h=l-i,c=u.smoothSide?1:2,f=h*c,x=u.smoothBevel?1:2,a=Math.min(r/2,u.bevelSize),v=u.bevelSegments,p=s.vertex,y=Math.max(o.width,o.height);if(a>0){const o=[0,0,1],l=[],u=[0,0,-1],g=[];let d=0,m=new Float32Array(h);for(let b=0;b<2;b++){const M=0===b?r-a:a;for(let r=0;r<=v*x;r++){let w,S,Z=0;for(let z=0;z<h;z++){for(let p=0;p<c;p++){let c=2*((z+p)%h+i);l[0]=e[c]-n[c],l[1]=e[c+1]-n[c+1],l[2]=0;const d=Math.sqrt(l[0]*l[0]+l[1]*l[1]);l[0]/=d,l[1]/=d;const R=(Math.floor(r/x)+r%x)/v;0===b?U(g,o,l,R):U(g,l,u,R);const A=0===b?R:1-R,q=a*Math.sin(A*Math.PI/2),B=d*Math.cos(A*Math.PI/2),O=a*d/Math.sqrt(q*q+B*B),P=g[0]*O+n[c],j=g[1]*O+n[c+1],F=g[2]*O+M;if(t.position[3*s.vertex]=P,t.position[3*s.vertex+1]=j,t.position[3*s.vertex+2]=F,(z>0||p>0)&&(Z+=Math.sqrt((w-P)*(w-P)+(S-j)*(S-j))),r>0||b>0){let e=3*(s.vertex-f),n=t.position[e],r=t.position[e+1],o=t.position[e+2];m[z]+=Math.sqrt((n-P)*(n-P)+(r-j)*(r-j)+(o-F)*(o-F))}t.uv[2*s.vertex]=Z/y,t.uv[2*s.vertex+1]=m[z]/y,w=P,S=j,s.vertex++}if(x>1&&r%x||1===x&&r>=1)for(let e=0;e<6;e++){const n=(H[e][0]+z*c)%f,r=H[e][1]+d;t.indices[s.index++]=(r-1)*f+n+p}}d++}}}else for(let n=0;n<2;n++){const o=0===n?r-a:a;let l,u,f=0;for(let n=0;n<h;n++)for(let r=0;r<c;r++){const c=2*((n+r)%h+i),x=e[c],a=e[c+1];t.position[3*s.vertex]=x,t.position[3*s.vertex+1]=a,t.position[3*s.vertex+2]=o,(n>0||r>0)&&(f+=Math.sqrt((l-x)*(l-x)+(u-a)*(u-a))),t.uv[2*s.vertex]=f/y,t.uv[2*s.vertex+1]=o/y,l=x,u=a,s.vertex++}}const g=a>0?v*x+1:1;for(let e=0;e<h;e++)for(let n=0;n<6;n++){const r=(H[n][0]+e*c)%f,o=H[n][1]+g;t.indices[s.index++]=(o-1)*f+r+p}}function Q({indices:t,vertices:e,topVertices:n,rect:r,depth:o},i,l,s){if(e.length<=4)return;const u=l.vertex,h=t.length;for(let e=0;e<h;e++)i.indices[l.index++]=u+t[e];const c=Math.max(r.width,r.height);for(let t=0;t<(s.excludeBottom?1:2);t++)for(let e=0;e<n.length;e+=2){const s=n[e],u=n[e+1];i.position[3*l.vertex]=s,i.position[3*l.vertex+1]=u,i.position[3*l.vertex+2]=(1-t)*o,i.uv[2*l.vertex]=(s-r.x)/c,i.uv[2*l.vertex+1]=(u-r.y)/c,l.vertex++}if(!s.excludeBottom){const n=e.length/2;for(let e=0;e<h;e+=3)for(let r=0;r<3;r++)i.indices[l.index++]=u+n+t[e+2-r]}}function T(t,e){let n=0,r=0;for(let o=0;o<t.length;o++){const{indices:i,vertices:l,holes:s,depth:u}=t[o],h=l.length/2,c=Math.min(u/2,e.bevelSize)>0?e.bevelSegments:0;n+=i.length*(e.excludeBottom?1:2),r+=h*(e.excludeBottom?1:2);const f=2+2*c;let x=0,a=0;for(let t=0;t<(s?s.length:0)+1;t++){0===t?a=s&&s.length?s[0]:h:(x=s[t-1],a=s[t]||h),n+=6*(a-x)*(f-1);const o=(a-x)*(e.smoothSide?1:2);r+=o*f+(e.smoothBevel?0:c*o*2)}}const o={position:new Float32Array(3*r),indices:new(r>65535?Uint32Array:Uint16Array)(n),uv:new Float32Array(2*r)},i={vertex:0,index:0};for(let n=0;n<t.length;n++)Q(t[n],o,i,e);for(let n=0;n<t.length;n++){const{holes:r,vertices:l}=t[n],s=l.length/2;let u=0,h=r&&r.length?r[0]:s;if(K(o,t[n],u,h,i,e),r)for(let l=0;l<r.length;l++)u=r[l],h=r[l+1]||s,K(o,t[n],u,h,i,e)}for(let t=0;t<o.uv.length;t++){const e=o.uv[t];e>0&&Math.round(e)===e?o.uv[t]=1:o.uv[t]=e%1}return o.normal=function(t,e){function n(t,e,n,r){t[0]=e,t[1]=n,t[2]=r}const r=[],o=[],i=[],l=[],s=[],u=[],h=t.length,c=new Float32Array(e.length);for(let b=0;b<h;){const h=3*t[b++],M=3*t[b++],w=3*t[b++];n(r,e[h],e[h+1],e[h+2]),n(o,e[M],e[M+1],e[M+2]),n(i,e[w],e[w+1],e[w+2]),F(l,r,o),F(s,o,i),f=u,a=s,v=(x=l)[0],p=x[1],y=x[2],g=a[0],d=a[1],m=a[2],f[0]=p*m-y*d,f[1]=y*g-v*m,f[2]=v*d-p*g;for(let t=0;t<3;t++)c[h+t]=c[h+t]+u[t],c[M+t]=c[M+t]+u[t],c[w+t]=c[w+t]+u[t]}for(var f,x,a,v,p,y,g,d,m,b=0;b<c.length;)n(u,c[b],c[b+1],c[b+2]),k(u,u),c[b++]=u[0],c[b++]=u[1],c[b++]=u[2];return c}(o.indices,o.position),o.boundingRect=t[0]&&t[0].rect,o}function X(t,e,n){const r=n.lineWidth,o=t.length,i=new Float32Array(2*o),l=n.translate||[0,0],s=n.scale||[1,1];for(let e=0,n=0;e<o;e++)i[n++]=t[e][0]*s[0]+l[0],i[n++]=t[e][1]*s[1]+l[1];V(i,0,o)<0&&J(i,2,0,o);const u=[],h=[],c=n.miterLimit,f=D(i,h,0,o,0,-r/2,c,!1);J(i,2,0,o);const x=D(i,u,0,o,0,-r/2,c,!1),a=(u.length+h.length)/2,v=new Float32Array(2*a);let p=0;const y=h.length/2;for(let t=0;t<h.length;t++)v[p++]=h[t];for(let t=0;t<u.length;t++)v[p++]=u[t];const g=new(a>65535?Uint32Array:Uint16Array)(3*(2*(o-1)+(a-2*o)));let d=0;for(let t=0;t<o-1;t++){const e=t+1;g[d++]=y-1-f[t],g[d++]=y-1-f[t]-1,g[d++]=x[t]+1+y,g[d++]=y-1-f[t],g[d++]=x[t]+1+y,g[d++]=x[t]+y,x[e]-x[t]==2?(g[d++]=x[t]+2+y,g[d++]=x[t]+1+y,g[d++]=y-f[e]-1):f[e]-f[t]==2&&(g[d++]=x[e]+y,g[d++]=y-1-(f[t]+1),g[d++]=y-1-(f[t]+2))}const m=n.bevelSize>0?G(v,[],n.bevelSize,null,!0):v,b=n.boundingRect;return{vertices:v,indices:g,topVertices:m,rect:{x:b.x*s[0]+l[0],y:b.y*s[1]+l[1],width:b.width*s[0],height:b.height*s[1]},depth:"function"==typeof n.depth?n.depth(e):n.depth,holes:[]}}function Y(t,e){const n=[];for(let r=0;r<t.length;r++){const o=t[r],i=[],l=o.length;let s=o[l-1][0],u=o[l-1][1],h=0;for(let t=0;t<l;t++){let n=o[t][0],r=o[t][1];const l=n-s,c=r-u;(h+=Math.sqrt(l*l+c*c))>e&&(i.push(o[t]),h=0),s=n,u=r}i.length>=3&&n.push(i)}return n.length>0?n:null}function $(t,e){const n=[];for(let r=0;r<t.length;r++){let o=t[r];(o=q(o,e,!0)).length>=3&&n.push(o)}return n.length>0?n:null}function tt(t,n){n=Object.assign({},n);const r=[1/0,1/0],o=[-1/0,-1/0];for(let e=0;e<t.length;e++)nt(t[e][0],r,o);n.boundingRect=n.boundingRect||{x:r[0],y:r[1],width:o[0]-r[0],height:o[1]-r[1]},C(n);const i=[],l=n.translate||[0,0],s=n.scale||[1,1],u=n.boundingRect,h={x:u.x*s[0]+l[0],y:u.y*s[1]+l[1],width:u.width*s[0],height:u.height*s[1]},c=Math.min(u.width,u.height)/1e5;for(let r=0;r<t.length;r++){let o=Y(t[r],c);if(!o)continue;const u=n.simplify/Math.max(s[0],s[1]);if(u>0&&(o=$(o,u)),!o)continue;const{vertices:f,holes:x,dimensions:a}=e.flatten(o);for(let t=0;t<f.length;)f[t]=f[t++]*s[0]+l[0],f[t]=f[t++]*s[1]+l[1];if(N(f,x),2!==a)throw new Error("Only 2D polygon points are supported");const v=n.bevelSize>0?G(f,x,n.bevelSize,null,!0):f,p=W(v,x,a);i.push({indices:p,vertices:f,topVertices:v,holes:x,rect:h,depth:"function"==typeof n.depth?n.depth(r):n.depth})}return T(i,n)}function et(t,e){e=Object.assign({},e);const n=[1/0,1/0],r=[-1/0,-1/0];for(let e=0;e<t.length;e++)nt(t[e],n,r);e.boundingRect=e.boundingRect||{x:n[0],y:n[1],width:r[0]-n[0],height:r[1]-n[1]},C(e);const o=e.scale||[1,1];null==e.lineWidth&&(e.lineWidth=1),null==e.miterLimit&&(e.miterLimit=2);const i=[];for(let n=0;n<t.length;n++){let r=t[n];const l=e.simplify/Math.max(o[0],o[1]);l>0&&(r=q(r,l,!0)),i.push(X(r,n,e))}return T(i,e)}function nt(t,e,n){for(let r=0;r<t.length;r++)e[0]=Math.min(t[r][0],e[0]),e[1]=Math.min(t[r][1],e[1]),n[0]=Math.max(t[r][0],n[0]),n[1]=Math.max(t[r][1],n[1])}t.triangulate=W,t.flatten=function(t){return e.flatten(t)},t.offsetPolygon=G,t.extrudePolygon=tt,t.extrudePolyline=et,t.extrudeGeoJSON=function(t,e){e=Object.assign({},e);const n=[],r=[],o=[],i=[],l=[1/0,1/0],s=[-1/0,-1/0];for(let e=0;e<t.features.length;e++){const u=t.features[e].geometry;if(u&&u.coordinates)switch(u.type){case"LineString":n.push(u.coordinates),o.push(e),nt(u.coordinates,l,s);break;case"MultiLineString":for(let t=0;t<u.coordinates.length;t++)n.push(u.coordinates[t]),o.push(e),nt(u.coordinates[t],l,s);break;case"Polygon":r.push(u.coordinates),i.push(e),nt(u.coordinates[0],l,s);break;case"MultiPolygon":for(let t=0;t<u.coordinates.length;t++)r.push(u.coordinates[t]),i.push(e),nt(u.coordinates[t][0],l,s)}}e.boundingRect=e.boundingRect||{x:l[0],y:l[1],width:s[0]-l[0],height:s[1]-l[1]};const u=e.depth;return{polyline:et(n,Object.assign(e,{depth:function(e){return"function"==typeof u?u(t.features[o[e]]):u}})),polygon:tt(r,Object.assign(e,{depth:function(e){return"function"==typeof u?u(t.features[i[e]]):u}}))}},Object.defineProperty(t,"__esModule",{value:!0})});
